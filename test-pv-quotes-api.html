<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PV-Quotes API Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .form-group { margin: 10px 0; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>PV-Quotes API Test</h1>
    
    <div class="test-section info">
        <h2>1. Debug-Endpoint Test</h2>
        <p>Testet die Grundkonfiguration und Datenbankverbindung</p>
        <button onclick="testDebugEndpoint()">Debug-Endpoint testen</button>
        <div id="debug-result"></div>
    </div>

    <div class="test-section info">
        <h2>2. Einfacher POST-Test</h2>
        <p>Testet das Speichern einer minimalen Anfrage</p>
        <button onclick="testSimplePost()">Einfachen POST testen</button>
        <div id="simple-post-result"></div>
    </div>

    <div class="test-section info">
        <h2>3. Vollständiger POST-Test</h2>
        <p>Testet das Speichern einer vollständigen PV-Anfrage</p>
        
        <div class="form-group">
            <label>Vorname:</label>
            <input type="text" id="firstName" value="Max" />
        </div>
        
        <div class="form-group">
            <label>Nachname:</label>
            <input type="text" id="lastName" value="Mustermann" />
        </div>
        
        <div class="form-group">
            <label>E-Mail:</label>
            <input type="email" id="email" value="max.mustermann@example.com" />
        </div>
        
        <div class="form-group">
            <label>Telefon (optional):</label>
            <input type="text" id="phone" value="+49 123 456789" />
        </div>
        
        <button onclick="testFullPost()">Vollständigen POST testen</button>
        <div id="full-post-result"></div>
    </div>

    <div class="test-section info">
        <h2>4. GET-Test</h2>
        <p>Testet das Abrufen gespeicherter Anfragen</p>
        <button onclick="testGet()">GET testen</button>
        <div id="get-result"></div>
    </div>

    <script>
        async function testDebugEndpoint() {
            const resultDiv = document.getElementById('debug-result');
            resultDiv.innerHTML = '<p>Teste Debug-Endpoint...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/api/pv-quotes/debug');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>✅ Debug-Test erfolgreich</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>❌ Debug-Test fehlgeschlagen</h3>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ Netzwerkfehler</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testSimplePost() {
            const resultDiv = document.getElementById('simple-post-result');
            resultDiv.innerHTML = '<p>Teste einfachen POST...</p>';
            
            const testData = {
                firstName: 'Test',
                lastName: 'User',
                email: 'test@example.com'
            };
            
            try {
                const response = await fetch('http://localhost:3000/api/pv-quotes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>✅ Einfacher POST erfolgreich</h3>
                            <p><strong>ID:</strong> ${data.id}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>❌ Einfacher POST fehlgeschlagen</h3>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ Netzwerkfehler</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testFullPost() {
            const resultDiv = document.getElementById('full-post-result');
            resultDiv.innerHTML = '<p>Teste vollständigen POST...</p>';
            
            const testData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: 'Hauptstraße 1',
                city: 'Berlin',
                postalCode: '10115',
                pvData: {
                    roofType: 'Satteldach',
                    roofTilt: 35,
                    annualConsumption: 4000,
                    electricityPrice: 35,
                    totalKWp: 10.5,
                    annualPV: 12000,
                    batteryKWh: 25,
                    roofFaces: [
                        {
                            id: 1,
                            areaHorizM2: 50,
                            tiltDeg: 35,
                            azimuthDeg: 180,
                            gtiKWhm2Year: 1100
                        }
                    ],
                    evData: {
                        kmPerYear: 20000,
                        kWhPer100km: 22,
                        homeChargingShare: 0.8,
                        chargerPowerKW: 11
                    },
                    heatPumpConsumption: 4000,
                    autarkie: 0.85,
                    eigenverbrauch: 0.65,
                    annualSavings: 1200,
                    co2Savings: 5.2,
                    paybackTime: 12.5
                }
            };
            
            try {
                const response = await fetch('http://localhost:3000/api/pv-quotes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>✅ Vollständiger POST erfolgreich</h3>
                            <p><strong>ID:</strong> ${data.id}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>❌ Vollständiger POST fehlgeschlagen</h3>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ Netzwerkfehler</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function testGet() {
            const resultDiv = document.getElementById('get-result');
            resultDiv.innerHTML = '<p>Teste GET...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/api/pv-quotes');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>✅ GET erfolgreich</h3>
                            <p><strong>Anzahl Anfragen:</strong> ${data.data?.length || 0}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>❌ GET fehlgeschlagen</h3>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ Netzwerkfehler</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
